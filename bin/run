#!/bin/bash

run_init() {
  direnv allow
}

say_hi() {
  # for testing
  echo "ðŸ‘‹ Hi!"
}

create_k3d_cluster() {
  k3d cluster create winterfell \
    --api-port 6550 \
    -p "80:80@loadbalancer" \
    -p "443:443@loadbalancer" \
    --agents 2
}

k3d_apply() {
  kubectl apply -f https://raw.githubusercontent.com/traefik/traefik/v2.10/docs/content/reference/dynamic-configuration/kubernetes-crd-definition-v1.yml
  kubectl apply -f kubernetes-files/
}

destroy_k3d_cluster() {
  k3d cluster delete winterfell
}

fn_exists() { declare -F "$1" >/dev/null; }

run() {
  local cmd=$1
  shift
  local fn="run_$cmd"

  if fn_exists $fn; then
    $fn ${@}
  else
    # with_dev_env
    eval $cmd "${@}"
  fi
}

run ${@}
